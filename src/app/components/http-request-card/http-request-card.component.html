<h1>Post Mini</h1>

<!-- Card for http request -->
<ng-template #requestFormTemplate>
  <form [formGroup]="requestForm" class="flex flex-col gap-3">
    <!-- End point of request -->
    <div class="flex flex-row gap-2">
      <!-- Verb -->
      <mat-form-field appearance="outline" class="flex flex-col gap-1 w-1/4">
        <mat-label>Verb</mat-label>
        <mat-select id="verb" formControlName="verb" class="text-lg h-full">
          <mat-option value="GET">GET</mat-option>
          <mat-option value="POST">POST</mat-option>
          <mat-option value="PUT">PUT</mat-option>
          <mat-option value="PATCH">PATCH</mat-option>
          <mat-option value="DELETE">DELETE</mat-option>
          <!-- Add more request types as needed -->
        </mat-select>
      </mat-form-field>

      <!-- URL -->
      <mat-form-field appearance="outline" class="flex flex-col gap-1 w-3/4">
        <mat-label>Target URL</mat-label>
        <input
          matInput
          type="text"
          id="url"
          formControlName="url"
          placeholder="https://your-url.io"
          class="text-lg"
          required
        />
        <mat-error> Please enter a valid url "http://..." </mat-error>
      </mat-form-field>
    </div>

    <mat-divider />

    <mat-tab-group
      mat-stretch-tabs="false"
      mat-align-tabs="start"
      dynamicHeight
      animationDuration="500"
    >
      <!-- Headers -->
      <mat-tab
        [label]="headerCount > 0 ? 'Headers (' + headerCount + ')' : 'Headers'"
        class="flex flex-col"
      >
        <app-key-value-table
          [parentFormGroup]="headers"
          [singularDisplayName]="'Header'"
          (enabledRowsCount)="setHeaderCount($event)"
        ></app-key-value-table>
      </mat-tab>

      <!-- Params -->
      <mat-tab
        [label]="paramCount > 0 ? 'Params (' + paramCount + ')' : 'Params'"
        class="flex flex-col"
      >
        <app-key-value-table
          [parentFormGroup]="params"
          [singularDisplayName]="'Param'"
          (enabledRowsCount)="setParamCount($event)"
        ></app-key-value-table>
      </mat-tab>

      <!-- Body -->
      <mat-tab label="Body" class="flex">
        <!-- Line numbers -->

        <div class="mt-3 ps-8">
          <div
            #lineNumbers
            class="absolute top-5 -left-1 text-right w-8 overflow-hidden"
          >
            @for (number of arrayOfNumberOfLines; track $index) {
            <p class="leading-[.5rem]">{{ number }}</p>
            }
          </div>

          <!-- Actual body text -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Raw Body</mat-label>
            <textarea
              #textarea
              matInput
              cdkTextareaAutosize
              #autosize="cdkTextareaAutosize"
              cdkAutosizeMinRows="3"
              type="text"
              id="body"
              formControlName="body"
              rows="4"
              placeholder="{&#10;  data: i-am-data&#10;}"
              (input)="updateNumberOfLines($event)"
            ></textarea>
          </mat-form-field>
        </div>
      </mat-tab>
    </mat-tab-group>
  </form>
</ng-template>

<mat-card>
  <mat-card-header>
    <mat-card-title>HTTP Request</mat-card-title>
  </mat-card-header>
  <mat-card-content class="mt-4">
    <ng-template [ngTemplateOutlet]="requestFormTemplate"></ng-template>
  </mat-card-content>
  <mat-card-actions>
    <button
      type="submit"
      mat-raised-button
      color="primary"
      (click)="sendRequest()"
    >
      Request
    </button>
  </mat-card-actions>
</mat-card>

<!-- Display loading indicator or error message based on the loading state -->
<div *ngIf="loadingState === LoadingState.Loading">Loading...</div>
<div *ngIf="loadingState === LoadingState.Error">
  Error occurred while loading.
</div>

<!-- Display response if the loading state is Loaded -->
<div *ngIf="loadingState === LoadingState.Loaded">
  <h3>Response:</h3>
  <pre>{{ response | json }}</pre>
</div>
